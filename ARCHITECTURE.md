# ğŸ—ï¸ ç³»ç»Ÿæ¶æ„æ–‡æ¡£

## The Constant Observer - æŠ€æœ¯æ¶æ„

---

## ğŸ“ æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  User Interface Layer                â”‚
â”‚  (Tailwind CSS + Custom CSS + HTML5 Canvas)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            Interaction Layer                        â”‚
â”‚  (MediaPipe Hand Recognition + Touch Events)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            State Management Layer                   â”‚
â”‚  (Tomori Mode State Machine)                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            Rendering Layer                          â”‚
â”‚  (Three.js + Canvas 2D + CSS3)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ­ ä¸¤å¹•å¼ç³»ç»Ÿæ¶æ„

### ç³»ç»ŸçŠ¶æ€æµè½¬

```
[åˆå§‹åŒ–]
  â”‚
  â”œâ”€â†’ [STATE.INTRO] ç²’å­è½¨é“åŠ¨ç”»
  â”‚
  â”œâ”€â†’ [STATE.IDLE] è›‹ç³•æ—‹è½¬ç­‰å¾…
  â”‚
  â”œâ”€â†’ [STATE.COUNTDOWN] 3-2-1å€’è®¡æ—¶
  â”‚
  â”œâ”€â†’ [STATE.BLOWING] è›‹ç³•æ˜¾ç¤º + å¹æ°”æ£€æµ‹
  â”‚
  â””â”€â†’ [STATE.CELEBRATION] ç²’å­åº†ç¥çˆ†ç‚¸

              [è¿›å…¥Tomoriå®‡å®™]
                  â”‚
                  â–¼
          [tomoriMode = true]
                  â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                 â”‚
         â–¼                 â–¼
    [é˜¶æ®µ1]          [é˜¶æ®µ2]
  æ‘„åƒæœºå–æ™¯æ¡†       å½—æ˜Ÿè½¨è¿¹æ•…äº‹
    â”‚                  â”‚
    â”œâ”€ æ¨¡ç³ŠèƒŒæ™¯        â”œâ”€ æ˜Ÿç©ºèƒŒæ™¯
    â”œâ”€ RECæŒ‡ç¤ºç¯       â”œâ”€ å½—æ˜Ÿè½¨è¿¹
    â”œâ”€ æ—¥æœŸæ—¶é—´        â”œâ”€ æ•…äº‹å¡ç‰‡Ã—4
    â”œâ”€ å¯¹ç„¦æç¤º        â”œâ”€ å½©è›‹æŒ‰é’®
    â””â”€ æ‰‹åŠ¿è¯†åˆ«        â””â”€ å¯¼èˆªäº¤äº’
         â”‚                  â”‚
         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
         [è¿”å›æ´¾å¯¹/é€€å‡º]
                â”‚
         [tomoriMode = false]
                â”‚
        [çŠ¶æ€å…¨éƒ¨å¤ä½]
```

---

## ğŸ¬ ç¬¬ä¸€å¹•ï¼šé•œå¤´å¼€å¯

### æ•°æ®ç»“æ„

```javascript
// æ¨¡ç³Šç²’å­
{
  x: number,           // Xä½ç½®
  y: number,           // Yä½ç½®
  vx: number,          // Xé€Ÿåº¦
  vy: number,          // Yé€Ÿåº¦
  radius: number,      // åŠå¾„
  opacity: number      // é€æ˜åº¦
}
```

### æ¸²æŸ“æµç¨‹

```
[initBlurField] åˆå§‹åŒ–
    â”‚
    â”œâ”€ åˆ›å»ºCanvas
    â”œâ”€ åˆå§‹åŒ–50ä¸ªç²’å­
    â””â”€ å¯åŠ¨requestAnimationFrame
         â”‚
         â–¼
    [drawBlurField] é€å¸§ç»˜åˆ¶
         â”‚
         â”œâ”€ æ¸…ç©ºCanvas
         â”œâ”€ æ›´æ–°ç²’å­ä½ç½®
         â”œâ”€ å¤„ç†ç¢°æ’
         â”œâ”€ æ¸²æŸ“æ¯ä¸ªç²’å­
         â””â”€ ç»§ç»­ä¸‹ä¸€å¸§
```

### æ‰‹åŠ¿è¯†åˆ«ç®—æ³•

```javascript
checkStage1HandGesture(landmarks) {
  // landmarks: [0-20] 21ä¸ªæ‰‹éƒ¨å…³é”®ç‚¹
  
  indexTip = landmarks[8]     // é£ŸæŒ‡å°–
  middleTip = landmarks[12]   // ä¸­æŒ‡å°–
  ringTip = landmarks[16]     // æ— åæŒ‡å°–
  
  // è·ç¦»è®¡ç®—
  indexMiddle = hypot(indexTip - middleTip)
  middleRing = hypot(middleTip - ringTip)
  
  // Væ‰‹åŠ¿åˆ¤å®š
  return (indexMiddle > 0.05) AND (middleRing < 0.03)
}
```

### çŠ¶æ€è½¬æ¢

```
[ç„¦ç‚¹æç¤º] "æ¯”ä¸ªâœŒï¸å¯¹ç„¦"
    â”‚
    â”‚ [æ‰‹åŠ¿è¯†åˆ«æˆåŠŸ]
    â”‚ â”œâ”€ handGestureDetected = true
    â”‚ â”œâ”€ focusHint.classList.add('hidden')
    â”‚ â””â”€ focusMessage.classList.add('active')
    â”‚
    â”œâ”€ 1500mså»¶è¿Ÿ
    â”‚
    â–¼
[å¯¹ç„¦æ¶ˆæ¯] "å½“æˆ‘çš„é•œå¤´æ•æ‰åˆ°ä½ ..."
    â”‚
    â”œâ”€ transitionToStage2()
    â”œâ”€ åœæ­¢ç¬¬ä¸€å¹•åŠ¨ç”»
    â”œâ”€ æ˜¾ç¤ºç¬¬äºŒå¹•
    â””â”€ åˆå§‹åŒ–æ˜Ÿç©º
```

---

## â­ ç¬¬äºŒå¹•ï¼šå½—æ˜Ÿè½¨è¿¹

### æ˜Ÿç©ºæ¸²æŸ“ç³»ç»Ÿ

```javascript
// æ˜Ÿæ˜Ÿå¯¹è±¡
{
  x: number,           // Xä½ç½®ï¼ˆå›ºå®šï¼‰
  y: number,           // Yä½ç½®ï¼ˆå›ºå®šï¼‰
  radius: number,      // åŠå¾„ï¼ˆ1-1.5ï¼‰
  opacity: number,     // é€æ˜åº¦ï¼ˆ0.3-1.0ï¼‰
  twinkleSpeed: number // é—ªçƒé€Ÿåº¦
}

// å½—æ˜Ÿè½¨è¿¹
cometProgress = (Date.now() % 8000) / 8000  // 0-1å¾ªç¯
cometX = canvas.width * cometProgress
cometY = canvas.height * 0.3
```

### Canvasæ¸²æŸ“é¡ºåº

```
ç¬¬äºŒå¹•Canvasç»˜åˆ¶é¡ºåºï¼ˆæ¯å¸§ï¼‰ï¼š
1. æ¸…ç©ºç”»å¸ƒï¼ˆåŠé€æ˜é»‘è‰²ï¼‰
2. ç»˜åˆ¶å½—æ˜Ÿè½¨è¿¹çº¿ï¼ˆé»„è‰²ï¼‰
3. ç»˜åˆ¶å½—æ˜Ÿå¤´éƒ¨ï¼ˆå¾„å‘æ¸å˜ï¼‰
4. æ›´æ–°å’Œç»˜åˆ¶æ‰€æœ‰æ˜Ÿæ˜Ÿ
   â”œâ”€ æ›´æ–°é—ªçƒé€Ÿåº¦
   â”œâ”€ è°ƒæ•´é€æ˜åº¦
   â””â”€ ç”¨æ–°çš„opacityç»˜åˆ¶
5. requestAnimationFrameç»§ç»­ä¸‹ä¸€å¸§
```

### æ•…äº‹èŠ‚ç‚¹æ•°æ®

```javascript
{
  index: 0-3,          // èŠ‚ç‚¹ç´¢å¼•
  icon: string,        // emojiå›¾æ ‡
  title: string,       // è‹±æ–‡æ ‡é¢˜
  chapter: string,     // ä¸­æ–‡ç« èŠ‚å
  text: string         // æ•…äº‹æ–‡æœ¬
}
```

### å¯¼èˆªäº¤äº’ç³»ç»Ÿ

```
[ç”¨æˆ·æ“ä½œ]
    â”‚
    â”œâ”€ æ¡Œè½®äº‹ä»¶
    â”‚  â”œâ”€ e.deltaY > 0 â†’ currentNodeIndex++
    â”‚  â””â”€ e.deltaY < 0 â†’ currentNodeIndex--
    â”‚
    â””â”€ è§¦æ‘¸äº‹ä»¶
       â”œâ”€ touchstart â†’ è®°å½•Yåæ ‡
       â”œâ”€ touchmove â†’ è®¡ç®—å·®å€¼
       â”‚  â”œâ”€ å‘ä¸Šæ»‘ (diff > 50) â†’ currentNodeIndex++
       â”‚  â””â”€ å‘ä¸‹æ»‘ (diff < -50) â†’ currentNodeIndex--
       â””â”€ æ›´æ–°è§¦æ‘¸èµ·ç‚¹
    
    â”‚
    â–¼
[è¾¹ç•Œæ£€æŸ¥]
    â”œâ”€ currentNodeIndex < 0 â†’ ä¿æŒ0
    â”œâ”€ currentNodeIndex > 3 â†’ ä¿æŒ3
    â””â”€ activateNode(currentNodeIndex)
         â”‚
         â–¼
    [CSSåŠ¨ç”»è½¬æ¢]
    â”œâ”€ ç§»é™¤æ‰€æœ‰å¡ç‰‡çš„activeç±»
    â”œâ”€ æ·»åŠ ç›®æ ‡å¡ç‰‡çš„activeç±»
    â””â”€ æ•…äº‹å¡ç‰‡æ·¡å…¥ï¼ˆopacity: 0 â†’ 1ï¼‰
```

---

## ğŸ å½©è›‹ç³»ç»Ÿ

### å¿ƒæƒ…æ€¥æ•‘åŒ…æµç¨‹

```
[ç‚¹å‡»ğŸ©¹æŒ‰é’®]
    â”‚
    â”œâ”€ e.stopPropagation()
    â”œâ”€ å±å¹•éœ‡åŠ¨
    â”‚  â””â”€ document.body.style.animation = 'shake-screen 0.5s'
    â”‚
    â”œâ”€ æ˜¾ç¤ºå¼¹çª—
    â”‚  â””â”€ heartfeltAidPopup.classList.add('active')
    â”‚     â”œâ”€ opacity: 0 â†’ 1
    â”‚     â”œâ”€ pointer-events: auto
    â”‚     â””â”€ transform: scale(1)
    â”‚
    â”œâ”€ é£è¸¢åŠ¨ç”»
    â”‚  â””â”€ .aid-animationåº”ç”¨kick-animation
    â”‚     â”œâ”€ scale(0) â†’ scale(1.3) â†’ scale(1)
    â”‚     â””â”€ rotate(0Â°) â†’ rotate(15Â°) â†’ rotate(0Â°)
    â”‚
    â””â”€ 2000msåè‡ªåŠ¨å…³é—­
       â””â”€ heartfeltAidPopup.classList.remove('active')
```

### ä¸‡èƒ½å…‘æ¢åˆ¸ç”Ÿæˆæµç¨‹

```
[ç‚¹å‡»ğŸ«æŒ‰é’®]
    â”‚
    â”œâ”€ generateVoucher()
    â”‚
    â”œâ”€ åˆ›å»ºCanvas (600Ã—400)
    â”‚
    â”œâ”€ ç»˜åˆ¶èƒŒæ™¯
    â”‚  â””â”€ createLinearGradient: #0f172a â†’ #1e293b
    â”‚
    â”œâ”€ ç»˜åˆ¶è¾¹æ¡†
    â”‚  â””â”€ strokeStyle: #a78bfa, lineWidth: 3
    â”‚
    â”œâ”€ ç»˜åˆ¶æ–‡æœ¬
    â”‚  â”œâ”€ æ ‡é¢˜: ã€æ— é™æœŸé™ªä¼´åˆ¸ã€‘(#fbbf24)
    â”‚  â”œâ”€ æŒæœ‰è€…: ä½ 
    â”‚  â”œâ”€ å‘è¡Œè€…: æ°¸è¿œçˆ±ä½ çš„äºº
    â”‚  â”œâ”€ æ•ˆåŠ›: æ— è®ºä½•æ—¶ä½•åœ°
    â”‚  â”œâ”€ å…‘æ¢è¯´æ˜
    â”‚  â””â”€ é™„æ³¨: å°±åƒå‹åˆ©å¯¹æœ‰å®‡é‚£æ ·
    â”‚
    â”œâ”€ è½¬æ¢ä¸ºData URL
    â”‚  â””â”€ canvas.toDataURL('image/png')
    â”‚
    â””â”€ åˆ›å»ºä¸‹è½½é“¾æ¥
       â”œâ”€ link.href = dataUrl
       â”œâ”€ link.download = 'æ— é™æœŸé™ªä¼´åˆ¸.png'
       â””â”€ link.click()
```

---

## ğŸ”„ çŠ¶æ€ç®¡ç†

### å…¨å±€çŠ¶æ€å˜é‡

```javascript
{
  // Tomoriå®‡å®™çŠ¶æ€
  tomoriMode: boolean,              // æ˜¯å¦åœ¨Tomoriæ¨¡å¼
  tomoriCurrentStage: 1 | 2,         // å½“å‰å¹•æ•°
  tomoriStarfieldAnimationId: ?number,  // ç¬¬äºŒå¹•åŠ¨ç”»å¸§ID
  tomoriBlurFieldAnimationId: ?number,  // ç¬¬ä¸€å¹•åŠ¨ç”»å¸§ID
  currentNodeIndex: 0-3,              // å½“å‰æ•…äº‹èŠ‚ç‚¹
  handGestureDetected: boolean       // æ‰‹åŠ¿æ˜¯å¦å·²æ£€æµ‹
}
```

### çŠ¶æ€è½¬æ¢çŸ©é˜µ

```
                Enter                    Exit
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           tomoriMode=false                       â”‚
â”‚     [è›‹ç³•æ´¾å¯¹åœºæ™¯ - STATE.IDLE/CELEBRATION]     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚                             â”‚
         [User clicks]            [User clicks è¿”å›]
             â”‚                             â”‚
             â–¼                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    tomoriMode=true, Stage=1                      â”‚
â”‚    [ç¬¬ä¸€å¹• - æ‘„åƒæœºå–æ™¯æ¡†]                      â”‚
â”‚    â”œâ”€ RECæŒ‡ç¤ºç¯é—ªçƒ                            â”‚
â”‚    â”œâ”€ æ¨¡ç³Šç²’å­æµ®åŠ¨                            â”‚
â”‚    â”œâ”€ æ‰‹åŠ¿è¯†åˆ«æ¿€æ´»                            â”‚
â”‚    â””â”€ æ—¥æœŸæ—¶é—´å®æ—¶æ›´æ–°                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚                             â”‚
   [æ‰‹åŠ¿è¯†åˆ«æˆåŠŸ]              [ç‚¹å‡»è¿”å›æŒ‰é’®]
        1500ms                      
             â”‚                             â”‚
             â–¼                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    tomoriMode=true, Stage=2                      â”‚
â”‚    [ç¬¬äºŒå¹• - å½—æ˜Ÿè½¨è¿¹æ•…äº‹]                      â”‚
â”‚    â”œâ”€ æ˜Ÿç©ºèƒŒæ™¯è¿ç»­æ¸²æŸ“                        â”‚
â”‚    â”œâ”€ å½—æ˜Ÿè½¨è¿¹å¾ªç¯è¿åŠ¨                        â”‚
â”‚    â”œâ”€ 4ä¸ªæ•…äº‹å¡ç‰‡æ˜¾ç¤º                        â”‚
â”‚    â”œâ”€ å¯¼èˆªäº¤äº’æ¿€æ´»                           â”‚
â”‚    â””â”€ å½©è›‹æŒ‰é’®å¯ç”¨                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚                             â”‚
      [ç»§ç»­æµè§ˆæ•…äº‹] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ [ç‚¹å‡»è¿”å›]
                                         â”‚
                                         â–¼
                                      [æ·¡å‡º800ms]
                                         â”‚
                                    [æ‰‹åŠ¿é‡ç½®]
                                         â”‚
                                    [âœ¨æŒ‰é’®å‡ºç°]
```

---

## ğŸ¨ CSSæ¶æ„

### é¢œè‰²ç³»ç»Ÿ

```css
:root {
  --midnight-blue: #0f172a;      /* ä¸»èƒŒæ™¯ */
  --deep-blue: #1e293b;          /* æ·±å±‚èƒŒæ™¯ */
  --silver-light: #e2e8f0;       /* æ–‡å­— */
  --purple-accent: #a78bfa;      /* å¼ºè°ƒ */
  --gold-accent: #fbbf24;        /* å½—æ˜Ÿ/REC */
  --rec-red: #ff4444;            /* RECç¯ */
}
```

### å¸ƒå±€ç³»ç»Ÿ

```
ç¬¬ä¸€å¹•å¸ƒå±€ (å›ºå®šå®šä½)ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [REC]  [æ¨¡ç³Šç²’å­]  [ç©º]  â”‚
â”‚                          â”‚
â”‚      [å¯¹ç„¦æç¤º/æ¶ˆæ¯]      â”‚
â”‚                          â”‚
â”‚      [æš—è§’æ•ˆæœ]          â”‚
â”‚                          â”‚
â”‚  [ç©º]  [æ¨¡ç³Šç²’å­]  [æ—¶é—´] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç¬¬äºŒå¹•å¸ƒå±€ (Flexå®¹å™¨)ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     [æ˜Ÿç©ºCanvas]         â”‚
â”‚     [å½—æ˜Ÿè½¨è¿¹]           â”‚
â”‚                          â”‚
â”‚ [æ•…äº‹å¡1]                â”‚
â”‚     â†“                    â”‚
â”‚ [æ•…äº‹å¡2]                â”‚
â”‚     â†“                    â”‚
â”‚ [æ•…äº‹å¡3]                â”‚
â”‚     â†“                    â”‚
â”‚ [æ•…äº‹å¡4]                â”‚
â”‚                          â”‚
â”‚ [ğŸ©¹] [è¿”å›æŒ‰é’®] [ğŸ«]    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š æ€§èƒ½æŒ‡æ ‡

### Canvasæ€§èƒ½ä¼˜åŒ–

| æŒ‡æ ‡ | ç¬¬ä¸€å¹• | ç¬¬äºŒå¹• | è¯´æ˜ |
|-----|-------|-------|------|
| ç²’å­æ•° | 50 | 300 | ç¬¬äºŒå¹•æ˜Ÿæ˜Ÿ |
| åˆ·æ–°ç‡ | 60fps | 60fps | ç›®æ ‡å¸§ç‡ |
| æ¨¡ç³Šæ»¤é•œ | 8px | - | ç¬¬ä¸€å¹•æ¨¡ç³Š |
| Canvaså¤§å° | 100vwÃ—100vh | 100vwÃ—100vh | å…¨å± |

### å†…å­˜ç®¡ç†

```javascript
// æ­£ç¡®æ¸…ç†åŠ¨ç”»å¸§
cancelAnimationFrame(tomoriStarfieldAnimationId);
cancelAnimationFrame(tomoriBlurFieldAnimationId);

// é‡ç½®æ ‡å¿—
tomoriStarfieldAnimationId = null;
tomoriBlurFieldAnimationId = null;

// é‡ç½®çŠ¶æ€
handGestureDetected = false;
```

---

## ğŸ”— é›†æˆç‚¹

### MediaPipeé›†æˆ

```javascript
hands.onResults((results) => {
  // ç¬¬ä¸€å¹•æ‰‹åŠ¿æ£€æµ‹
  if (tomoriMode && tomoriCurrentStage === 1) {
    const landmarks = results.multiHandLandmarks[0];
    if (checkStage1HandGesture(landmarks) && !handGestureDetected) {
      // è§¦å‘ç¬¬äºŒå¹•è½¬åœº
      transitionToStage2();
    }
  }
  
  // åŸæœ‰çš„è›‹ç³•äº¤äº’é€»è¾‘...
  // [ä¸å—Tomoriæ¨¡å¼å½±å“]
});
```

### éŸ³ä¹ç³»ç»Ÿé›†æˆ

```javascript
// Tomoriè¿›å…¥æ—¶
enterTomoriMode() {
  if (bgm.src && !bgm.src.includes('Kataomoi.mp3')) {
    bgm.pause();
    bgm.currentTime = 0;
  }
}

// HTMLä¸­çš„éŸ³é¢‘æ ‡ç­¾å·²å®šä¹‰
<audio id="bgm">
  <source src="./src/Kataomoi.mp3" type="audio/mpeg">
</audio>
```

---

## ğŸš€ æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

### 1. Canvasä¼˜åŒ–
- âœ… ä½¿ç”¨requestAnimationFrameè€Œä¸æ˜¯setInterval
- âœ… åªæ›´æ–°å¿…è¦çš„CanvasåŒºåŸŸ
- âœ… ä½¿ç”¨é€‚å½“çš„ç²’å­æ•°é‡ï¼ˆ50/300ï¼‰

### 2. DOMä¼˜åŒ–
- âœ… ä½¿ç”¨CSSç±»åˆ‡æ¢è€Œä¸æ˜¯é¢‘ç¹ä¿®æ”¹style
- âœ… äº‹ä»¶å§”æ‰˜è€Œä¸æ˜¯ä¸ºæ¯ä¸ªå…ƒç´ ç»‘å®š
- âœ… ä½¿ç”¨transitionè€Œä¸æ˜¯JavaScriptåŠ¨ç”»

### 3. å†…å­˜ä¼˜åŒ–
- âœ… æ­£ç¡®æ¸…ç†åŠ¨ç”»å¸§
- âœ… åŠæ—¶é‡ç½®å…¨å±€çŠ¶æ€
- âœ… é¿å…åˆ›å»ºæœªä½¿ç”¨çš„å¯¹è±¡

### 4. æ¸²æŸ“ä¼˜åŒ–
- âœ… ä½¿ç”¨translateZ(0)å¯ç”¨GPUåŠ é€Ÿ
- âœ… ä½¿ç”¨will-changeä¼˜åŒ–æ€§èƒ½
- âœ… é¿å…é¢‘ç¹é‡æ’/é‡ç»˜

---

## ğŸ“± å“åº”å¼æ¶æ„

### è§†å£é€‚é…

```javascript
// ç›‘å¬çª—å£ç¼©æ”¾
window.addEventListener('resize', () => {
  // ç¬¬ä¸€å¹•Canvasè‡ªé€‚åº”
  if (tomoriCurrentStage === 1) {
    ui.tomoriBlurField.width = window.innerWidth;
    ui.tomoriBlurField.height = window.innerHeight;
  }
  
  // ç¬¬äºŒå¹•Canvasè‡ªé€‚åº”
  if (tomoriCurrentStage === 2) {
    ui.tomoriStarfieldMain.width = window.innerWidth;
    ui.tomoriStarfieldMain.height = window.innerHeight;
  }
});
```

### è§¦æ‘¸ä¼˜åŒ–

```javascript
// é˜²æ­¢iOSå›å¼¹
document.body.style.touchAction = 'none';

// æ‰‹æŒ‡æ»‘åŠ¨é˜ˆå€¼
const TOUCH_THRESHOLD = 50;  // åƒç´ 

// å¿«é€Ÿæ»‘åŠ¨å“åº”
if (Math.abs(diff) > TOUCH_THRESHOLD) {
  // æ›´æ–°èŠ‚ç‚¹
}
```

---

## ğŸ” å®‰å…¨æ€§è€ƒé‡

### äº‹ä»¶é˜²æŠ¤
- âœ… æ‰€æœ‰äº‹ä»¶ç›‘å¬å™¨éƒ½ä½¿ç”¨e.stopPropagation()
- âœ… é¿å…äº‹ä»¶å†’æ³¡åˆ°å…¶ä»–å¤„ç†å™¨
- âœ… æ­£ç¡®å¤„ç†å¼‚æ­¥æ“ä½œ

### çŠ¶æ€éš”ç¦»
- âœ… Tomoriæ¨¡å¼ä¸è›‹ç³•äº¤äº’å®Œå…¨éš”ç¦»
- âœ… çŠ¶æ€è½¬æ¢ä½¿ç”¨æ˜ç¡®çš„æ£€æŸ¥
- âœ… é¿å…ç«æ€æ¡ä»¶

---

**æ¶æ„æ–‡æ¡£å®Œæˆ**  
**ç‰ˆæœ¬**ï¼š1.0  
**æœ€åæ›´æ–°**ï¼š2025å¹´12æœˆ17æ—¥
